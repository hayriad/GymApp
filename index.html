<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Gym Counter</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #121212; color: #fff; padding: 20px; }
        input, button, select {
            font-size: 20px; padding: 12px; margin: 10px auto;
            width: 80%; max-width: 350px; border-radius: 8px; border: none;
        }
        input, select { background: #1e1e1e; color: #fff; text-align: center; }
        button { background: #28a745; color: white; font-weight: bold; }
        button:hover { background: #218838; cursor: pointer; }
        .pause-btn { background: #ffc107; color: #000; }
        .resume-btn { background: #007bff; }
        h1 { margin-bottom: 20px; }
        h2 { margin-top: 20px; font-size: 24px; }
        #history { margin-top: 30px; text-align: left; max-width: 400px; margin-left: auto; margin-right: auto; }
        #history h3 { text-align: center; }
        #history li { background: #1e1e1e; padding: 10px; margin: 5px 0; border-radius: 6px; list-style: none; }
    </style>
</head>
<body>
    <h1>Smart Gym Counter</h1>
    <input type="number" id="maxReps" placeholder="Reps per set (1-50)" min="1" max="50"><br>
    <input type="number" id="sets" placeholder="Number of sets (1-10)" min="1" max="10"><br>
    <input type="number" id="startDelay" placeholder="Start delay (sec)" min="0"><br>
    <input type="number" id="repDelay" placeholder="Delay between reps (sec)" min="0"><br>
    <input type="number" id="restDelay" placeholder="Rest between sets (sec)" min="0"><br>
    <select id="mode">
        <option value="up">Count Up</option>
        <option value="down">Count Down</option>
    </select><br>
    <button onclick="startCounting()">Start</button>
    <button class="pause-btn" onclick="pauseCounting()">Pause</button>
    <button class="resume-btn" onclick="resumeCounting()">Resume</button>
    <h2 id="status"></h2>
    <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>
    <div id="history">
        <h3>Workout History</h3>
        <ul id="historyList"></ul>
    </div>
    <button id="logToHealth" style="display:none; background:#ff6b6b; color:#fff;">Log to Apple Health</button>

<script>
let paused = false, i = 0, currentSet = 1, maxReps, totalSets, repDelay, restDelay, mode, status, beep;
window.onload = function() {
    document.getElementById('maxReps').value = localStorage.getItem('maxReps') || '';
    document.getElementById('sets').value = localStorage.getItem('sets') || '';
    document.getElementById('startDelay').value = localStorage.getItem('startDelay') || '';
    document.getElementById('repDelay').value = localStorage.getItem('repDelay') || '';
    document.getElementById('restDelay').value = localStorage.getItem('restDelay') || '';
    document.getElementById('mode').value = localStorage.getItem('mode') || 'up';
    renderHistory();
};
function speak(text) { const utterance = new SpeechSynthesisUtterance(text); utterance.rate = 1; speechSynthesis.speak(utterance); }
async function wait(ms) { await new Promise(r => { let id = setInterval(() => { if (!paused) { clearInterval(id); setTimeout(r, 0); } }, 100); }); await new Promise(r => setTimeout(r, ms)); }
function pauseCounting() { paused = true; }
function resumeCounting() { paused = false; }
async function startCounting() {
    maxReps = parseInt(document.getElementById('maxReps').value);
    totalSets = parseInt(document.getElementById('sets').value);
    let startDelay = parseInt(document.getElementById('startDelay').value) * 1000;
    repDelay = parseInt(document.getElementById('repDelay').value) * 1000;
    restDelay = parseInt(document.getElementById('restDelay').value) * 1000;
    mode = document.getElementById('mode').value;
    status = document.getElementById('status');
    beep = document.getElementById('beep');
    if (isNaN(maxReps) || maxReps < 1 || maxReps > 50) { alert("Reps must be 1–50."); return; }
    if (isNaN(totalSets) || totalSets < 1 || totalSets > 10) { alert("Sets must be 1–10."); return; }
    localStorage.setItem('maxReps', maxReps); localStorage.setItem('sets', totalSets);
    localStorage.setItem('startDelay', startDelay / 1000); localStorage.setItem('repDelay', repDelay / 1000);
    localStorage.setItem('restDelay', restDelay / 1000); localStorage.setItem('mode', mode);
    status.innerText = `Starting in ${startDelay / 1000} sec...`; speak(`Starting in ${startDelay / 1000} seconds`); await wait(startDelay);
    for (currentSet = 1; currentSet <= totalSets; currentSet++) {
        speak(`Set ${currentSet} starting`);
        let halfway = Math.floor(maxReps / 2);
        for (i = (mode === 'up') ? 1 : maxReps; (mode === 'up') ? i <= maxReps : i >= 1; (mode === 'up') ? i++ : i--) {
            beep.play(); await wait(500);
            status.innerText = `Set ${currentSet}/${totalSets} - Rep: ${i}`;
            if (i === halfway) speak("Halfway there!");
            if (i === 1 && mode === 'down') speak("Last rep!");
            if (i === maxReps && mode === 'up') speak("Last rep!");
            speak(i); await wait(repDelay);
        }
        if (currentSet < totalSets) {
            status.innerText = `Rest for ${restDelay / 1000} sec`; speak(`Rest for ${restDelay / 1000} seconds`); await wait(restDelay);
        }
    }
    status.innerText = "Workout Complete!"; speak("Workout complete!");
    saveHistory(maxReps, totalSets);
}
function saveHistory(reps, sets) {
    let history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
    const entry = { reps, sets, date: new Date().toLocaleString() };
    history.unshift(entry); if (history.length > 5) history.pop();
    localStorage.setItem('workoutHistory', JSON.stringify(history)); renderHistory();
    document.getElementById('logToHealth').style.display = 'block';
    document.getElementById('logToHealth').onclick = () => logToHealthKit(entry);
}
function renderHistory() {
    let history = JSON.parse(localStorage.getItem('workoutHistory') || '[]');
    document.getElementById('historyList').innerHTML = history.map(h => `<li>${h.date}: ${h.sets} sets × ${h.reps} reps</li>`).join('');
}
function logToHealthKit(entry) {
    const shortcutName = "Log Gym Workout";
    const url = `shortcuts://run-shortcut?name=${encodeURIComponent(shortcutName)}&input=${encodeURIComponent(`${entry.sets} sets x ${entry.reps} reps`)}`;
    window.location.href = url;
}
</script>
</body>
</html>
